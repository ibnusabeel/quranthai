---
import Layout from "../../../components/Layout.astro";
import SurahCard from "../../../components/SurahCard.astro";
import { getCollection, getEntry } from "astro:content";
import { SURAHS } from "../../../data/surahs";

const { book } = Astro.params;

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå MDX
const bookEntry = await getEntry("books", book as string);

import SurahSearch from "../../../components/SurahSearch";

// ‡πÇ‡∏´‡∏•‡∏î‡∏ã‡∏π‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏µ‡πâ
const allTafsir = await getCollection("tafsir");
const bookTafsir = allTafsir.filter((entry) => entry.id.startsWith(`${book}/`));

// Identify available surahs
const availableSurahs = new Set<number>();
bookTafsir.forEach((entry) => {
  if (entry.data.surahNumber) {
    availableSurahs.add(entry.data.surahNumber);
  }
});

// Convert Set to Array for prop passing
const availableSurahsArray = Array.from(availableSurahs);

// Count total ayahs with tafsir (description files with actual content)
const tafsirAyahCount = bookTafsir.filter(
  (entry) =>
    entry.id.includes("/description") &&
    entry.body &&
    entry.body.trim().length > 0,
).length;
---

<Layout title={bookEntry?.data.titleThai || "Tafsir"}>
  <!-- Hero Section -->
  <section class="book-hero">
    <div class="hero-bg-pattern"></div>
    <div class="container">
      <a href="/" class="back-link">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M19 12H5M12 19l-7-7 7-7"></path>
        </svg>
        <span>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
      </a>

      <div class="hero-content">
        <div class="book-badge">
          <span class="badge-icon">üìñ</span>
          <span>‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£‡∏≠‡∏±‡∏•‡∏Å‡∏∏‡∏£‡∏≠‡∏≤‡∏ô</span>
        </div>

        <h1 class="book-title">{bookEntry?.data.titleThai}</h1>
        <p class="book-title-arabic text-arabic">
          {bookEntry?.data.titleArabic}
        </p>
        <p class="book-author">
          <span class="author-label">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô:</span>
          {bookEntry?.data.author}
        </p>

        <div class="book-stats">
          <div class="stat-item">
            <div class="stat-icon">üìö</div>
            <div class="stat-value">{availableSurahsArray.length}</div>
            <div class="stat-label">‡∏ã‡∏π‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">üìù</div>
            <div class="stat-value">{tafsirAyahCount}</div>
            <div class="stat-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏¢‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ü‡∏ã‡∏µ‡∏£‡πÅ‡∏•‡πâ‡∏ß</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Search Section -->
  <section class="search-section">
    <div class="container">
      <SurahSearch
        client:load
        surahs={SURAHS}
        availableSurahs={availableSurahsArray}
        bookSlug={book as string}
      />
    </div>
  </section>
</Layout>

<style>
  /* ==================== HERO SECTION ==================== */
  .book-hero {
    background: linear-gradient(
      135deg,
      hsl(215, 90%, 25%) 0%,
      hsl(215, 85%, 20%) 50%,
      hsl(215, 90%, 15%) 100%
    );
    color: white;
    padding: var(--space-16) 0 var(--space-12);
    position: relative;
    overflow: hidden;
    margin-bottom: var(--space-12);
  }

  .hero-bg-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.1;
    background-image:
      radial-gradient(
        circle at 20% 30%,
        var(--color-secondary-500) 0%,
        transparent 50%
      ),
      radial-gradient(
        circle at 80% 70%,
        var(--color-primary-400) 0%,
        transparent 50%
      );
    pointer-events: none;
  }

  .hero-content {
    position: relative;
    z-index: 1;
    text-align: center;
    max-width: 900px;
    margin: 0 auto;
    animation: fadeInUp 0.6s ease-out;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    color: rgba(255, 255, 255, 0.8);
    font-weight: var(--font-medium);
    margin-bottom: var(--space-8);
    text-decoration: none;
    transition: all var(--transition-base);
    font-size: var(--text-sm);
  }

  .back-link:hover {
    color: var(--color-secondary-400);
    transform: translateX(-4px);
  }

  .book-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-full);
    padding: var(--space-2) var(--space-5);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    margin-bottom: var(--space-6);
  }

  .badge-icon {
    font-size: var(--text-lg);
  }

  .book-title {
    font-size: var(--text-4xl);
    font-weight: var(--font-bold);
    line-height: var(--leading-tight);
    margin-bottom: var(--space-4);
    color: white;
  }

  .book-title-arabic {
    font-size: var(--text-3xl);
    color: var(--color-secondary-400);
    margin-bottom: var(--space-4);
    opacity: 0.95;
    line-height: var(--leading-relaxed);
  }

  .book-author {
    font-size: var(--text-xl);
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: var(--space-8);
  }

  .author-label {
    color: var(--color-secondary-400);
    font-weight: var(--font-semibold);
  }

  .book-stats {
    display: flex;
    gap: var(--space-8);
    justify-content: center;
    margin-top: var(--space-8);
  }

  .stat-item {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-xl);
    padding: var(--space-5);
    min-width: 120px;
    transition: all var(--transition-base);
  }

  .stat-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-4px);
    border-color: var(--color-secondary-400);
  }

  .stat-icon {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-2);
  }

  .stat-value {
    font-size: var(--text-3xl);
    font-weight: var(--font-bold);
    color: var(--color-secondary-400);
    line-height: 1;
    margin-bottom: var(--space-1);
  }

  .stat-label {
    font-size: var(--text-sm);
    opacity: 0.9;
    font-weight: var(--font-medium);
  }

  /* ==================== SEARCH SECTION ==================== */
  .search-section {
    padding: 0 0 var(--space-16);
  }

  .container {
    max-width: var(--container-xl);
    margin: 0 auto;
    padding: 0 var(--space-6);
  }

  /* ==================== ANIMATIONS ==================== */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ==================== RESPONSIVE ==================== */
  @media (max-width: 768px) {
    .book-hero {
      padding: var(--space-12) 0 var(--space-8);
    }

    .book-title {
      font-size: var(--text-3xl);
    }

    .book-title-arabic {
      font-size: var(--text-2xl);
    }

    .book-author {
      font-size: var(--text-base);
    }

    .book-stats {
      gap: var(--space-4);
    }

    .stat-item {
      min-width: 100px;
      padding: var(--space-4);
    }

    .stat-value {
      font-size: var(--text-2xl);
    }
  }

  /* ==================== DARK MODE ==================== */
  :global([data-theme="dark"]) .book-hero {
    background: linear-gradient(
      135deg,
      hsl(218, 35%, 15%) 0%,
      hsl(218, 40%, 10%) 50%,
      hsl(218, 45%, 8%) 100%
    );
  }

  :global([data-theme="dark"]) .hero-bg-pattern {
    opacity: 0.15;
  }

  :global([data-theme="dark"]) .book-badge {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.15);
  }

  :global([data-theme="dark"]) .stat-item {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.1);
  }

  :global([data-theme="dark"]) .stat-item:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: var(--color-secondary-500);
  }
</style>
